let T=(e,n,t,s)=>(e.events=e.events||{},e.events[t+10]||(e.events[t+10]=s(i=>{e.events[t].reduceRight((l,u)=>(u(l),l),{shared:{},...i})})),e.events[t]=e.events[t]||[],e.events[t].push(n),()=>{let i=e.events[t],l=i.indexOf(n);i.splice(l,1),i.length||(delete e.events[t],e.events[t+10](),delete e.events[t+10])}),g=1e3,N=(e,n)=>T(e,s=>{let i=n(s);i&&e.events[6].push(i)},5,s=>{let i=e.listen;e.listen=u=>(!e.lc&&!e.active&&(s(),e.active=!0),i(u));let l=e.off;return e.events[6]=[],e.off=()=>{setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let u of e.events[6])u();e.events[6]=[],l()}},g)},()=>{e.listen=i,e.off=l}}),a=[],U=e=>{let n,t=[],s={lc:0,value:e,set(i){s.value=i,s.notify()},get(){return s.lc||s.listen(()=>{})(),s.value},notify(i){n=t;let l=!a.length;for(let u=0;u<n.length;u++)a.push(n[u],s.value,i);if(l){for(let u=0;u<a.length;u+=3)a[u](a[u+1],a[u+2]);a.length=0}},listen(i){return t===n&&(t=t.slice()),s.lc=t.push(i),()=>{t===n&&(t=t.slice());let l=t.indexOf(i);~l&&(t.splice(l,1),s.lc--)}},subscribe(i){let l=s.listen(i);return i(s.value),l},off(){}};return s},h=(e={})=>{let n=U(e);return n.setKey=function(t,s){typeof s>"u"?t in n.value&&(n.value={...n.value},delete n.value[t],n.notify(t)):n.value[t]!==s&&(n.value={...n.value,[t]:s},n.notify(t))},n},c=e=>e,o={},d={addEventListener(){},removeEventListener(){}};function L(){try{return typeof localStorage<"u"}catch{return!1}}L()&&(o=localStorage);let O={addEventListener(e,n){window.addEventListener("storage",n)},removeEventListener(e,n){window.removeEventListener("storage",n)}};typeof window<"u"&&(d=O);function y(e,n={},t={}){let s=t.encode||c,i=t.decode||c,l=h(),u=l.setKey;l.setKey=(r,f)=>{typeof f>"u"?(t.listen!==!1&&d.perKey&&d.removeEventListener(e+r,v),delete o[e+r]):(t.listen!==!1&&d.perKey&&!(r in l.value)&&d.addEventListener(e+r,v),o[e+r]=s(f)),u(r,f)};let E=l.set;l.set=function(r){for(let f in r)l.setKey(f,r[f]);for(let f in l.value)f in r||l.setKey(f)};function v(r){r.key?r.key.startsWith(e)&&(r.newValue===null?u(r.key.slice(e.length),void 0):u(r.key.slice(e.length),i(r.newValue))):E({})}return N(l,()=>{let r={...n};for(let f in o)f.startsWith(e)&&(r[f.slice(e.length)]=i(o[f]));if(l.set(r),t.listen!==!1)return d.addEventListener(e,v),()=>{d.removeEventListener(e,v);for(let f in l.value)d.removeEventListener(e+f,v)}}),l}const M=y("playgroundStore",{},{encode(e){return JSON.stringify(e)},decode(e){try{return JSON.parse(e)}catch{return e}}});export{M as p};
