<!DOCTYPE html>
<html lang="fa" dir="rtl" class="h-full">
  <head>
    <!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-GR2RVT9K79"></script>


<!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<meta name="generator" content="Astro v1.8.0">

<!-- Primary Meta Tags -->
<title>ساخت یک منو موبایل در ری‌اکت</title>
<meta name="title" content="ساخت یک منو موبایل در ری‌اکت">
<meta name="description" content="قراره با هم یک منو موبایل بسازیم و حین انجام اینکار کلی چیزای باحال از ری‌اکت یاد بگیریم از جمله الگوی Compound Component و Render Props">

<meta name="google-site-verification" content="zHY3_g7-iPbCh2aQVzINBG2yX2ZK5g2PUuW4vrUutnw">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://ruhidev.com/blog/building-a-mobile-menu-component/">
<meta property="og:title" content="ساخت یک منو موبایل در ری‌اکت">
<meta property="og:description" content="قراره با هم یک منو موبایل بسازیم و حین انجام اینکار کلی چیزای باحال از ری‌اکت یاد بگیریم از جمله الگوی Compound Component و Render Props">
<meta property="og:image" content="https://res.cloudinary.com/ruhollahh/image/upload/v1662830449/ruhidev/Screenshot_from_2022-09-10_21-50-26_dquiup.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://ruhidev.com/blog/building-a-mobile-menu-component/">
<meta property="twitter:title" content="ساخت یک منو موبایل در ری‌اکت">
<meta property="twitter:description" content="قراره با هم یک منو موبایل بسازیم و حین انجام اینکار کلی چیزای باحال از ری‌اکت یاد بگیریم از جمله الگوی Compound Component و Render Props">
<meta property="twitter:image" content="https://res.cloudinary.com/ruhollahh/image/upload/v1662830449/ruhidev/Screenshot_from_2022-09-10_21-50-26_dquiup.png">

    <link rel="stylesheet" href="/theme.css">
  <link rel="stylesheet" href="/assets/blog.d5a0ad07.css" />
<link rel="stylesheet" href="/assets/index.241c70ab.css" /><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-GR2RVT9K79");
</script></head>

  <body class="h-full">
    <div class="with-playground h-full">
      <nav class="flex gap-5 items-center bg-[#3abff8] px-4 h-10 -mb-px">
        <a href="/blog" class="md:flex md:gap-2 -mt-[6px] md:m-0 no-underline acive:no-underline focus:no-underline hover:no-underline"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024" color="#002b3d" style="color:#002b3d" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M946.5 505L534.6 93.4a31.93 31.93 0 0 0-45.2 0L77.5 505c-12 12-18.8 28.3-18.8 45.3 0 35.3 28.7 64 64 64h43.4V908c0 17.7 14.3 32 32 32H448V716h112v224h265.9c17.7 0 32-14.3 32-32V614.3h43.4c17 0 33.3-6.7 45.3-18.8 24.9-25 24.9-65.5-.1-90.5z"></path></svg>
          <span class="hidden md:inline text-[#002b3d]">بلاگ</span>
        </a>
        <a href="#content" class="md:hidden no-underline acive:no-underline focus:no-underline hover:no-underline text-[#002b3d]">مطالعه</a>
        <a href="#editor" class="md:hidden no-underline acive:no-underline focus:no-underline hover:no-underline text-[#002b3d]">ویرایشگر کد</a>
      </nav>
      <div class="grid grid-flow-col auto-cols-[100%] md:block h-[calc(100%-2.5rem)] will-change-scroll overflow-x-auto overflow-y-hidden overscroll-contain snap-x snap-mandatory scroll-smooth">
        <div id="content" class="w-full md:w-1/2 h-full overflow-y-auto overflow-x-hidden custom-scrollbar snap-start">
          <main class="w-full">
            <article class="prose prose-lg lg:prose-xl min-w-full px-4">
              <div>
  <h2 class="m-0 p-0 font-bold" style="margin-block-end: 0.5rem;; margin-block-start: 1rem;">
    ساخت یک منو موبایل در ری‌اکت
  </h2>
  <time datetime="Sat Jan 28 2023 00:00:00 GMT+0330 (Iran Standard Time)">1 ماه پیش</time>
</div>
              <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).load=a=>{(async()=>await(await a())())()},window.dispatchEvent(new Event("astro:load"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><link rel="stylesheet" href="/assets/blog.d5a0ad07.css" />
<link rel="stylesheet" href="/assets/index.241c70ab.css" /><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-GR2RVT9K79");
</script><p>می‌خوایم باهم این منوی موبایل رو بسازیم:</p><div class="not-prose mx-auto max-w-full w-full text-gray-700"><div class="preview-wrapper w-full rounded-md relative"><div class="preview rounded-md flex flex-col min-h-[6rem] h-full w-full items-center gap-2 border bg-top p-4"><div class="mockup-window flex flex-col border w-full"><div class="w-full flex gap-4 justify-between items-center p-4 pt-0" dir="rtl"><div class="flex gap-2"><div class="h-3 w-3 bg-[#3E485F] rounded-full"></div><div class="h-3 w-3 bg-[#3E485F] rounded-full"></div><div class="h-3 w-3 bg-[#3E485F] rounded-full"></div></div><button title="بارگذاری مجدد"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" color="rgba(179, 197, 239, 0.8)" style="color:rgba(179, 197, 239, 0.8)" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><polyline points="1 4 1 10 7 10"></polyline><polyline points="23 20 23 14 17 14"></polyline><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path></svg></button></div><div class="mockup-inner w-full overflow-auto"><div class="py-5 lg:px-10"><astro-island uid="ZFPwep" component-url="/index.af874be3.js" component-export="default" renderer-url="/client.fddb5967.js" props="{}" ssr="" client="load" opts="{&quot;name&quot;:&quot;MobileMenuPreview&quot;,&quot;value&quot;:true}" await-children=""><div class="shadow-xl rounded-[50px] bg-white overflow-hidden "><div class="carousel relative overscroll-x-contain"><ul class="flex"><li class="carousel-item !py-7 !px-4 cursor-pointer "><div>ساده</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div class="transition-transform duration-300 translate-y-0 rotate-0">حالت‌دار</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div class="">حالت‌دار</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div class="transition-transform duration-300 translate-y-0">حالت‌دار</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div>اضافی</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div>اضافی</div></li><li class="carousel-item !py-7 !px-4 cursor-pointer "><div>اضافی</div></li></ul><div class="absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all hidden" style="transform:translateX(nullpx)"></div></div></div></astro-island></div></div></div></div></div></div><p>*برای اسکرول افقی منو در دسکتاپ دکمه Shift رو نگه دارید و بعد اسکرول کنید.</p><p>قاعدتا نمی‌خوایم از کتابخونه‌های UI استفاده کنیم و برای تمرین هم که شده قصد داریم همه جنبه‌هاش رو خودمون هندل کنیم، برای استایل‌دهی هم از Tailwind قراره استفاده کنیم.</p><p>البته تو این پست به رفتار کامپوننت پرداخته میشه و نه استایل‌ها!</p><p>نیاز داریم که این کامپوننت چنین API-ای داشته باشه:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">MobileMenu</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;ساده&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">isActive</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`transition-transform duration-300 ${</span></span>
<span class="line"><span style="color:#A5D6FF">          </span><span style="color:#C9D1D9">isActive</span></span>
<span class="line"><span style="color:#A5D6FF">            </span><span style="color:#FF7B72">?</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;-translate-y-2 -rotate-[360deg]&quot;</span></span>
<span class="line"><span style="color:#A5D6FF">            </span><span style="color:#FF7B72">:</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;translate-y-0 rotate-0&quot;</span></span>
<span class="line"><span style="color:#A5D6FF">        </span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        حالت‌دار</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">isActive</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">isActive </span><span style="color:#FF7B72">?</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;animate-bounce&quot;</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">:</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;حالت‌دار&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">isActive</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`transition-transform duration-300 ${</span></span>
<span class="line"><span style="color:#A5D6FF">          </span><span style="color:#C9D1D9">isActive</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">?</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;-translate-y-2 animate-pulse&quot;</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">:</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;translate-y-0&quot;</span></span>
<span class="line"><span style="color:#A5D6FF">        </span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        حالت‌دار</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;اضافی&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;اضافی&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;اضافی&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  &lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">MobileMenu</span><span style="color:#C9D1D9">&gt;</span></span></code></pre>
</figure><p>همونطور که تو مثال بالا مشاهده می‌کنیم در صورت نیاز باید بتونیم با پاس دادن تابع به عنوان فرزند، به استیتِ فعال بودن یا نبودن هر کدوم از آیتم دسترسی داشته باشیم.</p><p>تعداد آیتم‌ها هم محدودیتی نباید داشته باشه و اگه جا نشن باید بتونیم به صورت افقی اسکرول کنیم.</p><h2 id="چه-چیزهایی-قراره-یاد-بگیریم">چه چیزهایی قراره یاد بگیریم؟</h2><p>با ساختن این کامپوننت با دوتا الگوی مهم به نام‌های Compound Component و Render Props قرار هست آشنا بشیم.</p><p>به علاوه یه مقدار با Context سروکله می‌زنیم و یاد می‌گیریم چطور به شکلی بهینه از تعداد زیادی المان (که ممکنه تعدادشون رو هم ندونیم) در ری‌اکت ref بگیریم و کنترل‌شون کنیم.</p><p>یه کم هم در مورد کش کردن با useCallback و useMemo صحبت می‌کنیم.</p><h3 id="چطور-باید-این-پست-رو-مطالعه-کنم">چطور باید این پست رو مطالعه کنم؟</h3><p>حقیقتا راه و روش خاصی نداره، اما توصیه‌م اینه که مرحله به مرحله کدهارو وارد ادیتور کنید.</p><p>می‌تونید از ادیتوری که سمت چپ قرار گرفته برای اینکار استفاده کنید، اگه در موبایل دارید این مطلب رو مطالعه می‌کنید روی عبارت «ویرایشگر کد» که در نوار بالا قرار گرفته کلیک کنید.</p><p>✍️ هر وقت این ایموجی رو دیدی یعنی باید یه تغییری توی ادیتور ایجاد کنی.</p><p>دقت داشته باشید که کلاس‌های تیلویند موجوده و می‌تونید ازشون استفاده کنید، اگه خودتون هم خواستید کلاسی ایجاد کنید می‌تونید در فایل styles اینکار رو انجام بدید و از اون کلاس استفاده کنید، نیازی به ایمپورت کردن فایل styles نیست.</p><p>موارد دیگه مثل هوک‌های ری‌اکتی رو هم می‌تونید مثل همیشه و به صورت عادی ایمپورت و استفاده کنید.</p><h3 id="الگوی-compound-component">الگوی Compound Component</h3><p>کامپوننت زیر رو در نظر بگیرید:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({item}) </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  return &lt;li&gt;{item}</span><span style="color:#FF7B72">&lt;/</span><span style="color:#C9D1D9">li</span><span style="color:#FF7B72">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">List</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({</span><span style="color:#FFA657">items</span><span style="color:#C9D1D9">}) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">items.</span><span style="color:#D2A8FF">map</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> &lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">key</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">item</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">item</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">item</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> /&gt;)</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  )</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#FFA657"> </span><span style="color:#FF7B72">default</span><span style="color:#FFA657"> </span><span style="color:#C9D1D9">List</span></span></code></pre>
</figure><p>و مثلا به این شکل داریم ازش استفاده می‌کنیم:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> List </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;./List&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">App</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">items</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">3</span><span style="color:#C9D1D9">];</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> &lt;</span><span style="color:#7EE787">List</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">items</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">items</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9"> /&gt;;</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>تو این حالت اگه قصد داشته باشیم پراپی رو به Item-ای که داخل این کامپوننت قرار گرفته پاس بدیم مجبوریم اون پراپ رو به List هم پاس بدیم.</p><p>به این کار می‌گن Prop Drilling، یعنی List خودش به صورت مستقیم از اون پراپ استفاده نمی‌کنه و فقط نقش واسط رو داره.</p><p>این قضیه باعث می‌شه تعداد پراپ‌های یک کامپوننت بره بالا چون علاوه بر پراپ‌های خودش پراپ‌های فرزندانش رو هم دریافت می‌کنه!</p><p>چاره چیه؟ مسئولیت رندر فرزندان رو بسپریم به همون شخصی که قرار هست از این کامپوننت استفاده کنه:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({</span><ins><span style="color:#c9d1d9">children</span></ins><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#C9D1D9">delegated}) </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  return &lt;li {</span><span style="color:#FF7B72">...</span><span style="color:#C9D1D9">delegated}</span><span style="color:#FF7B72">&gt;</span><ins><span style="color:#c9d1d9">{children}</span></ins><span style="color:#FF7B72">&lt;/</span><span style="color:#C9D1D9">li</span><span style="color:#FF7B72">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">List</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> (</span><ins><span style="color:#c9d1d9">{</span><span style="color:#ffa657">children</span><span style="color:#c9d1d9">}</span></ins><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><ins><span style="color:#ffa19a">{</span><span style="color:#c9d1d9">children</span><span style="color:#ffa19a">}</span></ins></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">export</span><span style="color:#C9D1D9"> {List, Item}</span></span></code></pre>
</figure><p>و به این شکل می‌تونیم ازش استفاده کنیم:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { List, </span><mark><span style="color:#c9d1d9">Item</span></mark><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;./List&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">App</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">items</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">1</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">2</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">3</span><span style="color:#C9D1D9">];</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">List</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">items.</span><span style="color:#D2A8FF">map</span><span style="color:#C9D1D9">((</span><span style="color:#FFA657">item</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line mark"><span style="color:#c9d1d9">        &lt;</span><span style="color:#7ee787">Item</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">key</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">item</span><span style="color:#ffa19a">}</span><span style="color:#c9d1d9">&gt;</span><span style="color:#ffa19a">{</span><span style="color:#c9d1d9">item</span><span style="color:#ffa19a">}</span><span style="color:#c9d1d9">&lt;/</span><span style="color:#7ee787">Item</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      ))</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">List</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>حالا اگه نیاز باشه چیزی به Item-ها پاس بدیم میتونیم مستقیما این کار رو انجام بدیم.</p><p>میشه گفت این روش به صورت کلی این مزایا رو داره:</p><ul>
<li>کاهش پراپ‌ها و جلوگیری از prop drilling</li>
<li>کنترل بیشتر روی نحوه رندر شدن اجزای کامپوننت</li>
<li>انعطاف‌پذیری بیشتر در استفاده</li>
</ul><p>✍️ خب حالا بریم سراغ کامپوننت خودمون:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><ins><span style="color:#ffa657">children</span></ins><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      &lt;</span><span style="color:#7ee787">div</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">className</span><span style="color:#ffa19a">=</span><span style="color:#a5d6ff">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><ins><span style="color:#ffa19a">{</span><span style="color:#c9d1d9">children</span><span style="color:#ffa19a">}</span></ins></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* the div below is representing the green dot */</span><span style="color:#FF7B72">}</span></span>
<span class="line ins"><span style="color:#c9d1d9">        &lt;</span><span style="color:#7ee787">div</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">className</span><span style="color:#ffa19a">=</span><span style="color:#a5d6ff">&quot;absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all&quot;</span><span style="color:#c9d1d9">&gt;&lt;/</span><span style="color:#7ee787">div</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      &lt;/</span><span style="color:#7ee787">div</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span>
<span class="line"><span style="color:#C9D1D9">  </span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><ins><span style="color:#ffa657">children</span></ins><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><ins><span style="color:#ffa19a">{</span><span style="color:#c9d1d9">children</span><span style="color:#ffa19a">}</span></ins></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>همونطور که مشاهده می‌کنید ساختار کلی و استایل‌ها پیاده‌سازی شدن، اکثر کلاس‌های tailwind خیلی واضح هستن و توضیح خاصی نمی‌خوان ولی اگه ابهامی تو قسمت استایل‌ها بود تو لینکدین بپرسید حتما جواب میدم، البته داک خودش هم هست و اول بهتره به اونجا مراجعه کنید.</p><p>در هر صورت هنوز بخش سخت‌تر کار مونده، زمانی که آیتمی انتخاب میشه نقطه سبز رنگ باید به وسط اون آیتم حرکت کنه.</p><p>دقت کنید می‌خوایم حرکت کنه، یعنی انیمیشن داشته باشه و همینطوری یهو زیر آیتم ظاهر نشه و خب چالش کار هم همینه :)</p><h2 id="دسترسی-فرزندان-به-استیت-والد">دسترسی فرزندان به استیت والد</h2><p>مسئله‌ای که پیش رو داریم این هست که یک سری استیت و تابع قرار هست در کامپوننت والد بنویسیم که به یک سری‌هاشون در کامپوننت‌های فرزند نیاز داریم.</p><p>مثلا برای اینکه بتونیم موقعیت قرارگیری نقطه سبز رنگ رو مشخص کنیم باید از همه آیتم‌ها ref داشته باشیم و این ref-هارو قصد داریم در کامپوننت والد ذخیره کنیم.</p><p>✍️ در واقع فقط یک ref در کامپوننت والد خواهیم داشت که ref همه آیتم‌ها رو در قالب Map در خودش نگه‌داری می‌کنه:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line ins"><span style="color:#ffa19a">import</span><span style="color:#c9d1d9"> { useRef, useCallback } </span><span style="color:#ffa19a">from</span><span style="color:#c9d1d9"> </span><span style="color:#a5d6ff">&#39;react&#39;</span><span style="color:#c9d1d9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&#39;&#39;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemsRef</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useRef</span><span style="color:#c9d1d9">(</span><span style="color:#79c0ff">null</span><span style="color:#c9d1d9">);</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">getMap</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useCallback</span><span style="color:#c9d1d9">(() </span><span style="color:#ffa19a">=&gt;</span><span style="color:#c9d1d9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">    </span><span style="color:#ffa19a">if</span><span style="color:#c9d1d9"> (</span><span style="color:#ffa19a">!</span><span style="color:#c9d1d9">itemsRef.current) {</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#b5bbc1">// Initialize the Map on first usage.</span></span>
<span class="line ins"><span style="color:#c9d1d9">      itemsRef.current </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">new</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">Map</span><span style="color:#c9d1d9">();</span></span>
<span class="line ins"><span style="color:#c9d1d9">    }</span></span>
<span class="line ins"><span style="color:#c9d1d9">    </span><span style="color:#ffa19a">return</span><span style="color:#c9d1d9"> itemsRef.current;</span></span>
<span class="line ins"><span style="color:#c9d1d9">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#FF7B72">{</span><span style="color:#8B949E">/* the div below is representing the green dot */</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all&quot;</span><span style="color:#C9D1D9">&gt;&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
</figure><p>زمانی که getMap برای اولین بار صدا زده بشه Map-مون ساخته میشه و چون در ref ذخیره شده در ری‌رندرها تغییر نمی‌کنه و با پاس دادن این تابع به فرزندان این قابلیت رو به هر فرزند میدیم که موقع ساخته شدن، ref خودش رو در داخل Map ذخیره کنه.</p><p>مشکل هم دقیقا همینه ما باید یه جوری بتونیم به children چیزهایی که می‌خوایم رو پاس بدیم.</p><p>✍️ برای اینکار قصد داریم از کانتکست استفاده کنیم:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useRef, useCallback, </span><ins><span style="color:#c9d1d9">createContext</span></ins><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;react&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line ins"><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">MobileMenuContext</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">createContext</span><span style="color:#c9d1d9">(</span><span style="color:#79c0ff">undefined</span><span style="color:#c9d1d9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemsRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useRef</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">getMap</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#D2A8FF">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">itemsRef.current) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// Initialize the Map on first usage.</span></span>
<span class="line"><span style="color:#C9D1D9">      itemsRef.current </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Map</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> itemsRef.current;</span></span>
<span class="line"><span style="color:#C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line ins"><span style="color:#c9d1d9">          &lt;</span><span style="color:#7ee787">MobileMenuContext.Provider</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">value</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">{ getMap }</span><span style="color:#ffa19a">}</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line ins"><span style="color:#c9d1d9">          &lt;/</span><span style="color:#7ee787">MobileMenuContext.Provider</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all&quot;</span><span style="color:#C9D1D9">&gt;&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>✍️ حالا می‌تونیم تو کامپوننت‌های فرزند به راحتی به تابع getMap دسترسی داشته باشیم:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useRef, useCallback, createContext, </span><ins><span style="color:#c9d1d9">useContext</span></ins><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;react&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> { </span><span style="color:#79c0ff">getMap</span><span style="color:#c9d1d9"> } </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useContext</span><span style="color:#c9d1d9">(MobileMenuContext);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>دقت داشته باشید که هر دو کامپوننت MobileMenu و Item داخل یک فایل هستند و به همین خاطر هست که به MobileMenuContext دسترسی داریم.</p><h2 id="بازی-با-dom">بازی با DOM</h2><p>خب حالا که همه آیتم‌ها به این تابع دسترسی دارند باید کاری کنیم که هر آیتم موقع اضافه شدن به DOM داخل یک ref قرار بگیره و سپس اون ref رو داخل Map-ای که در کامپوننت والد هست قرار بده.</p><p>اگه فقط بحث ref گرفتن مطرح بود می‌تونستیم خیلی ساده از مقدار برگشتی هوک useRef استفاده کنیم، به این شکل:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useContext</span><span style="color:#C9D1D9">(MobileMenuContext);</span></span>
<span class="line mark"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemRef</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useRef</span><span style="color:#c9d1d9">(</span><span style="color:#79c0ff">null</span><span style="color:#c9d1d9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><mark><span style="color:#79c0ff">ref</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">itemRef</span><span style="color:#ffa19a">}</span></mark></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>اما کاری ما قصد داریم انجام بدیم فقط ref گرفتن نیست، علاوه بر این ما نیاز داریم بلافاصله بعد از اینکه node مورد نظر در دسترس ما قرار گرفت اون رو به Map اضافه کنیم.</p><p>شاید اینجا دلتون بخواد از useEffect استفاده کنید و درحال حاضر مشکلی هم پیش نیاد، اما استفاده از useEffect برای هندل کردن این موارد اصلا پیشنهاد نمی‌شه.</p><p>دلیلش رو می‌تونید <a href="https://ruhidev.com/blog/use-effect-or-dont">توی این پست</a> مطالعه کنید</p><p>✍️ راه حلی که خود داک ری‌اکت برای هندل کردن این جور موارد پیشنهاد کرده استفاده از callback ref هست:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useRef, useCallback, createContext, useContext, </span><ins><span style="color:#c9d1d9">useId</span></ins><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;react&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useContext</span><span style="color:#C9D1D9">(MobileMenuContext);</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemId</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useId</span><span style="color:#c9d1d9">();</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemRef</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useCallback</span><span style="color:#c9d1d9">(</span></span>
<span class="line ins"><span style="color:#c9d1d9">    (</span><span style="color:#ffa657">node</span><span style="color:#c9d1d9">) </span><span style="color:#ffa19a">=&gt;</span><span style="color:#c9d1d9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">map</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">getMap</span><span style="color:#c9d1d9">();</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">if</span><span style="color:#c9d1d9"> (node) {</span></span>
<span class="line ins"><span style="color:#c9d1d9">        map.</span><span style="color:#d2a8ff">set</span><span style="color:#c9d1d9">(itemId, node);</span></span>
<span class="line ins"><span style="color:#c9d1d9">      } </span><span style="color:#ffa19a">else</span><span style="color:#c9d1d9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">        map.</span><span style="color:#d2a8ff">delete</span><span style="color:#c9d1d9">(itemId);</span></span>
<span class="line ins"><span style="color:#c9d1d9">      }</span></span>
<span class="line ins"><span style="color:#c9d1d9">    }, [itemId, getMap]</span></span>
<span class="line ins"><span style="color:#c9d1d9">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><ins><span style="color:#79c0ff">ref</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">itemRef</span><span style="color:#ffa19a">}</span></ins></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>تو این روش به جای پاس دادن مقدار برگشتی useRef به المان، خودمون باید یک تابع بسازیم و اون تابع رو به ویژگی ref المان‌مون پاس بدیم (در واقع اصلا از useRef استفاده نمی‌کنیم).</p><p>هر زمان که المان ما mount بشه، ری‌اکت این تابع رو صدا می‌زنه و node مورد نظر رو بهش پاس میده و هر زمان هم که اون المان unmount بشه ری‌اکت دوباره این تابع رو صدا می‌زنه اما این بار با مقدار null.</p><p>در واقع این روش reliability خیلی بیشتری نسبت به استفاده از useEffect داره و خیلی کم‌تر ممکنه به باگ برخورد کنیم.</p><p>دوتا نکته راجع به قطعه کد بالا:</p><ul>
<li>از هوک useId خود ری‌اکت برای تولید آیدی منحصر به فرد برای هر کدوم از آیتم‌ها استفاده کردیم.</li>
<li>از هوک useCallback هم برای کش کردن callback ref استفاده کردیم که بین ری‌رندرها تغییر نکنه.</li>
</ul><p>یه نکته مهم: حالا که تابع getMap داخل لیست وابستگی‌های useCallback قرار گرفته خودش هم باید کش بشه در غیراینصورت هر بار که کامپوننت والد ری‌رندر بشه callback-ref-مون هم بدون دلیل داره تغییر می‌کنه.</p><p>✍️ به این شکل این تابع رو ریفکتور می‌کنیم:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemsRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useRef</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><mark><span style="color:#d2a8ff">useCallback</span></mark><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">itemsRef.current) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// Initialize the Map on first usage.</span></span>
<span class="line"><span style="color:#C9D1D9">      itemsRef.current </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Map</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> itemsRef.current;</span></span>
<span class="line"><span style="color:#C9D1D9">  }, </span><mark><span style="color:#c9d1d9">[]</span></mark><span style="color:#C9D1D9">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;</span><span style="color:#7EE787">MobileMenuContext.Provider</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{ getMap }</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;/</span><span style="color:#7EE787">MobileMenuContext.Provider</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all&quot;</span><span style="color:#C9D1D9">&gt;&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>دقت داشته باشید که نیازی نیست itemRef رو داخل لیست وابستگی‌ها قرار بدیم چون بین ری‌رندرها تغییر نمیکنه و قرار دادنش تو لیست وابستگی‌ها بیهوده‌ست.</p><p>به همین صورت itemRef.current رو هم نیازی نیست در این لیست قرار بدیم چون تغییر کردنش باعث ری‌رندر شدن کامپوننت نمیشه و به همین دلیل از نظر ری‌اکت به عنوان وابستگی معتبر نیست و لیست وابستگی‌هامون اینجا خالی باقی می‌مونه.</p><p>* اگه بخوایم می‌تونیم آبجکتی که به عنوان value به MobileMenuContext.Provider پاس داده میشه رو هم memoize کنیم ولی حقیقتا فکر نمی‌کنم نیاز باشه و بنظرم بهتره تا جایی که می‌تونیم پیچیدگی کدمون رو کمتر کنیم.</p><h2 id="ارتباط-بین-کامپوننت-والد-و-فرزندان">ارتباط بین کامپوننت والد و فرزندان</h2><p>هر وقت روی هر کدوم از آیتم‌ها کلیک بشه نیاز داریم که اون آیتم به اصطلاح «انتخاب» بشه و استیت مربوط به این مورد هم باید حتما در کامپوننت والد قرار داده بشه، چرا؟ چون تو این مورد معنا نمیده هر آيتم برای خودش یک استیت جداگونه داشته باشه و قاعدتا در لحظه فقط یک آيتم می‌تونه در حالت «انتخاب شده» باشه.</p><p>✍️ استیت آیتم انتخاب شده و تابعی که مسئول انتخاب آیتم هست رو مثل مورد قبلی از طریق همون کانتکست در دسترس فرزندان قرار میدیم:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">import</span><span style="color:#C9D1D9"> { useRef, useCallback, createContext, useContext, useId, </span><ins><span style="color:#c9d1d9">useState</span></ins><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">from</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;react&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> [</span><span style="color:#79c0ff">activeItem</span><span style="color:#c9d1d9">, </span><span style="color:#79c0ff">setActiveItem</span><span style="color:#c9d1d9">] </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">useState</span><span style="color:#c9d1d9">(</span><span style="color:#79c0ff">null</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemsRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useRef</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">itemsRef.current) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// Initialize the Map on first usage.</span></span>
<span class="line"><span style="color:#C9D1D9">      itemsRef.current </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Map</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> itemsRef.current;</span></span>
<span class="line"><span style="color:#C9D1D9">  }, []);</span></span>
<span class="line"></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">handleSelect</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> (</span><span style="color:#ffa657">itemId</span><span style="color:#c9d1d9">) </span><span style="color:#ffa19a">=&gt;</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">setActiveItem</span><span style="color:#c9d1d9">(itemId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;</span><span style="color:#7EE787">MobileMenuContext.Provider</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{</span></span>
<span class="line ins"><span style="color:#c9d1d9">              handleSelect,</span></span>
<span class="line ins"><span style="color:#c9d1d9">              activeItem,</span></span>
<span class="line"><span style="color:#C9D1D9">              getMap,</span></span>
<span class="line"><span style="color:#C9D1D9">            }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;/</span><span style="color:#7EE787">MobileMenuContext.Provider</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all&quot;</span><span style="color:#C9D1D9">&gt;&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>✍️ حالا کافیه تا داخل کامپوننت‌های فرزند از این مقادیر استفاده کنیم:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9">, </span><ins><span style="color:#79c0ff">activeItem</span><span style="color:#c9d1d9">, </span><span style="color:#79c0ff">handleSelect</span></ins><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useContext</span><span style="color:#C9D1D9">(MobileMenuContext);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemId</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useId</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(</span></span>
<span class="line"><span style="color:#C9D1D9">    (</span><span style="color:#FFA657">node</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">map</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">getMap</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (node) {</span></span>
<span class="line"><span style="color:#C9D1D9">        map.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(itemId, node);</span></span>
<span class="line"><span style="color:#C9D1D9">      } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">        map.</span><span style="color:#D2A8FF">delete</span><span style="color:#C9D1D9">(itemId);</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"><span style="color:#C9D1D9">    }, [itemId, getMap]</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">ref</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">itemRef</span><span style="color:#FF7B72">}</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#79c0ff">onClick</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">(</span><span style="color:#ffa657">e</span><span style="color:#c9d1d9">) </span><span style="color:#ffa19a">=&gt;</span><span style="color:#c9d1d9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">        e.currentTarget.</span><span style="color:#d2a8ff">scrollIntoView</span><span style="color:#c9d1d9">({</span></span>
<span class="line ins"><span style="color:#c9d1d9">          block: </span><span style="color:#a5d6ff">&quot;nearest&quot;</span><span style="color:#c9d1d9">,</span></span>
<span class="line ins"><span style="color:#c9d1d9">          behavior: </span><span style="color:#a5d6ff">&quot;smooth&quot;</span><span style="color:#c9d1d9">,</span></span>
<span class="line ins"><span style="color:#c9d1d9">          inline: </span><span style="color:#a5d6ff">&quot;center&quot;</span><span style="color:#c9d1d9">,</span></span>
<span class="line ins"><span style="color:#c9d1d9">        });</span></span>
<span class="line ins"><span style="color:#c9d1d9">        </span><span style="color:#d2a8ff">handleSelect</span><span style="color:#c9d1d9">(itemId);</span></span>
<span class="line ins"><span style="color:#c9d1d9">      }</span><span style="color:#ffa19a">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>دوتا نکته:</p><ul>
<li>با مقدار activeItem تو بخش رندرپراپس کار داریم و فعلا نادیده بگیریدش</li>
<li>از اونجایی که ممکنه قسمتی از آیتم از عرض کانتینر خارج شده باشه و قابل مشاهده نباشه، زمانی که روی یک آیتم کلیک میشه ابتدا اسکرول اتفاق می‌افته که کل آیتم قابل مشاهده بشه و بعد تابع handleSelect رو با آیدی اون آیتم صدا می‌زنیم.</li>
</ul><h2 id="derived-state">derived state</h2><p>خب حالا می‌رسیم به بخشی که باعث شده این همه کار انجام بدیم :)</p><p>✍️ می‌دونستیم که برای محاسبه موقعیت نقطه نشان‌گر به ref مربوط به آیتم انتخاب شده نیاز داریم و حالا می‌تونیم تابعی بنویسیم که این موقعیت رو بهمون برگردونه:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">MobileMenu</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> [</span><span style="color:#79C0FF">activeItem</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">setActiveItem</span><span style="color:#C9D1D9">] </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useState</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemsRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useRef</span><span style="color:#C9D1D9">(</span><span style="color:#79C0FF">null</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(() </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (</span><span style="color:#FF7B72">!</span><span style="color:#C9D1D9">itemsRef.current) {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#8B949E">// Initialize the Map on first usage.</span></span>
<span class="line"><span style="color:#C9D1D9">      itemsRef.current </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">new</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Map</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">    }</span></span>
<span class="line"><span style="color:#C9D1D9">    </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> itemsRef.current;</span></span>
<span class="line"><span style="color:#C9D1D9">  }, []);</span></span>
<span class="line"></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">getIndicatorPosition</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> (</span><span style="color:#ffa657">itemId</span><span style="color:#c9d1d9">) </span><span style="color:#ffa19a">=&gt;</span><span style="color:#c9d1d9"> {</span></span>
<span class="line ins"><span style="color:#c9d1d9">    </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">map</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">getMap</span><span style="color:#c9d1d9">();</span></span>
<span class="line ins"><span style="color:#c9d1d9">    </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">node</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> map.</span><span style="color:#d2a8ff">get</span><span style="color:#c9d1d9">(itemId);</span></span>
<span class="line ins"><span style="color:#c9d1d9">    </span><span style="color:#ffa19a">if</span><span style="color:#c9d1d9"> (node </span><span style="color:#ffa19a">&amp;&amp;</span><span style="color:#c9d1d9"> node.parentElement) {</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">parentOffsetRight</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> node.parentElement.</span><span style="color:#d2a8ff">getBoundingClientRect</span><span style="color:#c9d1d9">().right;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemWidth</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> node.</span><span style="color:#d2a8ff">getBoundingClientRect</span><span style="color:#c9d1d9">().width;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">itemOffsetRight</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> node.</span><span style="color:#d2a8ff">getBoundingClientRect</span><span style="color:#c9d1d9">().right;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#b5bbc1">// remember that our indicator&#39;s width was 6px?</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">centerOfItem</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span></span>
<span class="line ins"><span style="color:#c9d1d9">        itemOffsetRight </span><span style="color:#ffa19a">-</span><span style="color:#c9d1d9"> parentOffsetRight </span><span style="color:#ffa19a">-</span><span style="color:#c9d1d9"> itemWidth </span><span style="color:#ffa19a">/</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">2</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">+</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">3</span><span style="color:#c9d1d9">;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">return</span><span style="color:#c9d1d9"> centerOfItem;</span></span>
<span class="line ins"><span style="color:#c9d1d9">    }</span></span>
<span class="line ins"><span style="color:#c9d1d9">  };</span></span>
<span class="line"></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">indicatorPosition</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> activeItem </span><span style="color:#ffa19a">&amp;&amp;</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">getIndicatorPosition</span><span style="color:#c9d1d9">(activeItem);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">handleSelect</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> (</span><span style="color:#FFA657">itemId</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">setActiveItem</span><span style="color:#C9D1D9">(itemId);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;relative overflow-x-scroll no-scrollbar snap-x snap-mandatory scroll-smooth overscroll-x-contain whitespace-nowrap&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">=</span><span style="color:#A5D6FF">&quot;flex&quot;</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;</span><span style="color:#7EE787">MobileMenuContext.Provider</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#79C0FF">value</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">{</span></span>
<span class="line"><span style="color:#C9D1D9">              activeItem,</span></span>
<span class="line"><span style="color:#C9D1D9">              getMap,</span></span>
<span class="line"><span style="color:#C9D1D9">              handleSelect,</span></span>
<span class="line"><span style="color:#C9D1D9">            }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">            </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">children</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">          &lt;/</span><span style="color:#7EE787">MobileMenuContext.Provider</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;/</span><span style="color:#7EE787">ul</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">        &lt;</span><span style="color:#7EE787">div</span></span>
<span class="line ins"><span style="color:#c9d1d9">          </span><span style="color:#79c0ff">className</span><span style="color:#ffa19a">={</span><span style="color:#a5d6ff">`absolute bottom-2 bg-green-600 w-1.5 h-1.5 rounded-full transition-all ${</span></span>
<span class="line ins"><span style="color:#a5d6ff">            </span><span style="color:#c9d1d9">activeItem</span><span style="color:#a5d6ff"> </span><span style="color:#ffa19a">?</span><span style="color:#a5d6ff"> </span><span style="color:#a5d6ff">&quot;block&quot;</span><span style="color:#a5d6ff"> </span><span style="color:#ffa19a">:</span><span style="color:#a5d6ff"> </span><span style="color:#a5d6ff">&quot;hidden&quot;</span></span>
<span class="line ins"><span style="color:#a5d6ff">          </span><span style="color:#a5d6ff">}`</span><span style="color:#ffa19a">}</span></span>
<span class="line ins"><span style="color:#c9d1d9">          </span><span style="color:#79c0ff">style</span><span style="color:#ffa19a">={</span><span style="color:#c9d1d9">{</span></span>
<span class="line ins"><span style="color:#c9d1d9">            transform: </span><span style="color:#a5d6ff">`translateX(${</span><span style="color:#c9d1d9">indicatorPosition</span><span style="color:#a5d6ff">}px)`</span><span style="color:#c9d1d9">,</span></span>
<span class="line ins"><span style="color:#c9d1d9">          }</span><span style="color:#ffa19a">}</span></span>
<span class="line"><span style="color:#C9D1D9">        &gt;&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>همونطور که می‌بینید در همون ابتدا اومدیم و موقعیت نقطه رو بر اساس آیتم انتخاب شده محاسبه کردیم و تا زمانی هم که آیتمی انتخاب نشده باشه نقطه رو نشون نمیدیم.</p><p>نکته مهمی که اینجا وجود داره این هست که برای indicatorPosition استیت جداگونه نساختیم و مقدارش رو بر اساس activeItem محاسبه کردیم و به همین دلیل از اصطلاح derived state برای متغییرهایی مثل indicatorPosition استفاده می‌کنیم.</p><p>در واقع هر زمان که مقدار activeItem تغییر کنه مقدار indicatorPosition هم تغییر می‌کنه و هیچ نیازی به استیت جداگونه نیست.</p><h2 id="render-props">render props</h2><p>اگه رندر پراپس رو سرچ کنید به این تعریف می‌رسید: رندر پراپس روشی برای به اشتراک گذاری لاجیک غیر ui بین کامپوننت‌هاست (یا یه همچین چیزی).</p><p>شبیه چیه به نظرتون؟ هوک‌های ری‌اکتی!</p><p>در واقع قبل از این که هوک‌ها وارد ری‌اکت بشن یکی از روش‌های به اشتراک گذاری کد بین کامپوننت‌های مختلف استفاده از render props بود.</p><p>این روش به این شکل بود که می‌اومدن یه کامپوننت می‌ساختن و داخلش کدهایی که می‌خواستن به اشتراک بذارن رو قرار میدادن.</p><p>این کامپوننت تنها وظیفش این بود که این کدهارو با بقیه کامپوننت‌هایی که ui رندر می‌کردن به اشتراک بگذاره.</p><p>چطوری؟ خب این کامپوننت از خودش ui رندر نمی‌کرد و به جاش یه پراپ می‌گرفت به اسم render که یه فانکشن بود.</p><p>کامپوننت render props ما میومد و چیزایی که می‌خواست به اشتراک بذاره رو پاس میداد به این فانکشن و در نهایت این فانکشن render بود که jsx برمی‌گردوند:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">SharedCode</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({render}) {</span></span>
<span class="line"><span style="color:#C9D1D9">  const someThingThatIWantToShare </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;blahblah&quot;</span><span style="color:#C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  return </span><span style="color:#D2A8FF">render</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">someThingThatIWantToShare</span><span style="color:#C9D1D9">);</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">ComponentA</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({</span><span style="color:#FFA657">text</span><span style="color:#C9D1D9">}) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">text</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">ComponentB</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({</span><span style="color:#FFA657">text</span><span style="color:#C9D1D9">}) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> &lt;</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">text</span><span style="color:#FF7B72">}</span><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">div</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">App</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> () </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">SharedCode</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">render</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(text) </span><span style="color:#FF7B72">&lt;</span><span style="color:#C9D1D9">ComponentA text</span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9">{text} </span><span style="color:#FF7B72">/&gt;}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">SharedCode</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">render</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(text) </span><span style="color:#FF7B72">&lt;</span><span style="color:#C9D1D9">ComponentB text</span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9">{text} </span><span style="color:#FF7B72">/&gt;}</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  )</span></span>
<span class="line"><span style="color:#C9D1D9">}</span></span></code></pre>
</figure><p>ما هم اینجا قصد داریم آیتمی که داریم رندر می‌کنیم استیت داخلی خودش رو با فرزندانش به اشتراک بگذاره.</p><p>در واقع children تو این سناریو نقش همون پراپ render رو داره و یه فانکشن هست که یه مقداری دریافت می‌کنه و jsx برمی‌گردونه:</p>
<figure class="code-snippet lang-jsx">
  <figcaption class="header" dir="ltr">
    
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#C9D1D9">&lt;</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">{</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">isActive</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">Text</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`transition-transform duration-300 ${</span></span>
<span class="line"><span style="color:#A5D6FF">        </span><span style="color:#C9D1D9">isActive</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">?</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;-translate-y-2 -rotate-[360deg]&quot;</span><span style="color:#A5D6FF"> </span><span style="color:#FF7B72">:</span><span style="color:#A5D6FF"> </span><span style="color:#A5D6FF">&quot;translate-y-0 rotate-0&quot;</span></span>
<span class="line"><span style="color:#A5D6FF">      </span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line"><span style="color:#C9D1D9">      چرخش</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">Text</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  )</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">&lt;/</span><span style="color:#7EE787">Item</span><span style="color:#C9D1D9">&gt;</span></span></code></pre>
</figure><p>زمانی که کامپوننت Item این تابع رو میبینه میاد و isActive رو به این تابع پاس میده و اون رو صدا میزنه.</p><p>✍️ متغییر isActive چیه؟ این متغییر هم یک derived state هست که از activeItem نشات می‌گیره:</p>
<figure class="code-snippet has-title lang-jsx">
  <figcaption class="header" dir="ltr">
    <span class="title">components/<wbr/>MobileMenu.jsx</span>
  </figcaption>
  <pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">Item</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> ({ </span><span style="color:#FFA657">children</span><span style="color:#C9D1D9">, </span><span style="color:#FFA657">className</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#A5D6FF">&quot;&quot;</span><span style="color:#C9D1D9">, </span><span style="color:#FF7B72">...</span><span style="color:#FFA657">delegated</span><span style="color:#C9D1D9"> }) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> { </span><span style="color:#79C0FF">getMap</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">activeItem</span><span style="color:#C9D1D9">, </span><span style="color:#79C0FF">handleSelect</span><span style="color:#C9D1D9"> } </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useContext</span><span style="color:#C9D1D9">(MobileMenuContext);</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemId</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useId</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">itemRef</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">useCallback</span><span style="color:#C9D1D9">(</span></span>
<span class="line"><span style="color:#C9D1D9">    (</span><span style="color:#FFA657">node</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">const</span><span style="color:#C9D1D9"> </span><span style="color:#79C0FF">map</span><span style="color:#C9D1D9"> </span><span style="color:#FF7B72">=</span><span style="color:#C9D1D9"> </span><span style="color:#D2A8FF">getMap</span><span style="color:#C9D1D9">();</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">if</span><span style="color:#C9D1D9"> (node) {</span></span>
<span class="line"><span style="color:#C9D1D9">        map.</span><span style="color:#D2A8FF">set</span><span style="color:#C9D1D9">(itemId, node);</span></span>
<span class="line"><span style="color:#C9D1D9">      } </span><span style="color:#FF7B72">else</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">        map.</span><span style="color:#D2A8FF">delete</span><span style="color:#C9D1D9">(itemId);</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span></span>
<span class="line"><span style="color:#C9D1D9">    }, [itemId, getMap]</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"></span>
<span class="line ins"><span style="color:#c9d1d9">  </span><span style="color:#ffa19a">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">isActive</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">=</span><span style="color:#c9d1d9"> itemId </span><span style="color:#ffa19a">===</span><span style="color:#c9d1d9"> activeItem;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9">  </span><span style="color:#FF7B72">return</span><span style="color:#C9D1D9"> (</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;</span><span style="color:#7EE787">li</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">className</span><span style="color:#FF7B72">={</span><span style="color:#A5D6FF">`snap-center py-7 px-4 cursor-pointer ${</span><span style="color:#C9D1D9">className</span><span style="color:#A5D6FF">}`</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">ref</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">itemRef</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#79C0FF">onClick</span><span style="color:#FF7B72">={</span><span style="color:#C9D1D9">(</span><span style="color:#FFA657">e</span><span style="color:#C9D1D9">) </span><span style="color:#FF7B72">=&gt;</span><span style="color:#C9D1D9"> {</span></span>
<span class="line"><span style="color:#C9D1D9">        e.currentTarget.</span><span style="color:#D2A8FF">scrollIntoView</span><span style="color:#C9D1D9">({</span></span>
<span class="line"><span style="color:#C9D1D9">          block: </span><span style="color:#A5D6FF">&quot;nearest&quot;</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">          behavior: </span><span style="color:#A5D6FF">&quot;smooth&quot;</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">          inline: </span><span style="color:#A5D6FF">&quot;center&quot;</span><span style="color:#C9D1D9">,</span></span>
<span class="line"><span style="color:#C9D1D9">        });</span></span>
<span class="line"><span style="color:#C9D1D9">        </span><span style="color:#D2A8FF">handleSelect</span><span style="color:#C9D1D9">(itemId);</span></span>
<span class="line"><span style="color:#C9D1D9">      }</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">      </span><span style="color:#FF7B72">{...</span><span style="color:#C9D1D9">delegated</span><span style="color:#FF7B72">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &gt;</span></span>
<span class="line ins"><span style="color:#c9d1d9">      </span><span style="color:#ffa19a">{typeof</span><span style="color:#c9d1d9"> children </span><span style="color:#ffa19a">===</span><span style="color:#c9d1d9"> </span><span style="color:#a5d6ff">&quot;function&quot;</span><span style="color:#c9d1d9"> </span><span style="color:#ffa19a">?</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">children</span><span style="color:#c9d1d9">(isActive) </span><span style="color:#ffa19a">:</span><span style="color:#c9d1d9"> children</span><span style="color:#ffa19a">}</span></span>
<span class="line"><span style="color:#C9D1D9">    &lt;/</span><span style="color:#7EE787">li</span><span style="color:#C9D1D9">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9">  );</span></span>
<span class="line"><span style="color:#C9D1D9">};</span></span></code></pre>
</figure><p>ابتدا تایپ children رو بررسی کردیم و اگه از نوع تابع باشه اون رو با مقدار isActive صدا می‌زنیم.</p><p>خب تموم شد! یه مقدار طولانی و خسته کننده بود ولی امیدوارد مفید بوده باشه.</p><p>انتقاد یا پیشنهادی داشتید می‌تونید در لینکدین بهم برسونید، ممنون.</p>
            </article>
          </main>
          <div class="py-8 pr-4 text-[rgba(179,197,239,0.5)]">
            <a href="/blog">&lt;- بازگشت</a>
          </div>
        </div>
        <aside id="editor" class="md:fixed md:left-0 md:top-0 md:bottom-0 md:h-full md:w-1/2 w-full snap-start">
          <script>(self.Astro=self.Astro||{}).only=t=>{(async()=>await(await t())())()},window.dispatchEvent(new Event("astro:only"));</script><astro-island uid="FitN2" component-url="/index.b29b0254.js" component-export="default" renderer-url="/client.fddb5967.js" props="{&quot;initStore&quot;:[0,{&quot;files&quot;:[0,{&quot;/components/MobileMenu.jsx&quot;:[0,{&quot;code&quot;:[0,&quot;const MobileMenu = ({ className = &#39;&#39;, ...delegated }) =&gt; {\n  return (\n    &lt;div\n        className={`fixed bottom-3 left-[9px] right-[9px] shadow-xl rounded-[50px] bg-white overflow-hidden ${className}`}\n        {...delegated}\n    &gt;\n      &lt;ul className=\&quot;flex\&quot;&gt;\n        منو ویرایش کن!\n      &lt;/ul&gt;\n    &lt;/div&gt;\n  );\n};\n  \nconst Item = ({ className = \&quot;\&quot;, ...delegated }) =&gt; {\n  return (\n    &lt;li\n      className={`snap-center py-7 px-4 cursor-pointer ${className}`}\n      {...delegated}\n    &gt;\n      TODO\n    &lt;/li&gt;\n  );\n};\n  \nexport { MobileMenu, Item };\n&quot;],&quot;active&quot;:[0,true]}],&quot;/App.js&quot;:[0,&quot;import { MobileMenu, Item } from &#39;./components/MobileMenu&#39;;    \n\nexport default function App() {\n  return (\n    &lt;MobileMenu&gt;\n      &lt;Item selected&gt;\n        &lt;div&gt;ساده&lt;/div&gt;\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        {(isActive) =&gt; (\n          &lt;div\n            className={`transition-transform duration-300 ${\n            isActive\n                ? \&quot;-translate-y-2 -rotate-[360deg]\&quot;\n                : \&quot;translate-y-0 rotate-0\&quot;\n            }`}\n          &gt;\n            حالت‌دار\n          &lt;/div&gt;\n        )}\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        {(isActive) =&gt; (\n          &lt;div className={isActive ? \&quot;animate-bounce\&quot; : \&quot;\&quot;}&gt;حالت‌دار&lt;/div&gt;\n        )}\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        {(isActive) =&gt; (\n          &lt;div\n            className={`transition-transform duration-300 ${\n            isActive ? \&quot;-translate-y-2 animate-pulse\&quot; : \&quot;translate-y-0\&quot;\n            }`}\n          &gt;\n            حالت‌دار\n          &lt;/div&gt;\n        )}\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        &lt;div&gt;اضافی&lt;/div&gt;\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        &lt;div&gt;اضافی&lt;/div&gt;\n      &lt;/Item&gt;\n      &lt;Item&gt;\n        &lt;div&gt;اضافی&lt;/div&gt;\n      &lt;/Item&gt;\n    &lt;/MobileMenu&gt;\n  )\n}&quot;],&quot;/styles.css&quot;:[0,&quot;@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  html, body, #root {\n    height: 100%;\n  }\n  \n  body {\n    background-color: white;\n  }\n}\n\n@layer utilities {\n  /* Hide scrollbar for Chrome, Safari and Opera */\n  .no-scrollbar::-webkit-scrollbar {\n    display: none;\n  }\n\n  /* Hide scrollbar for IE, Edge and Firefox */\n  .no-scrollbar {\n    -ms-overflow-style: none; /* IE and Edge */\n    scrollbar-width: none; /* Firefox */\n  }\n}\n&quot;],&quot;/index.js&quot;:[0,{&quot;code&quot;:[0,&quot;import React, { StrictMode } from \&quot;react\&quot;;\n    import { createRoot } from \&quot;react-dom/client\&quot;;\n    import \&quot;./styles.css\&quot;;\n    import App from \&quot;./App\&quot;;\n    const root = createRoot(document.getElementById(\&quot;root\&quot;));\n    root.render(\n      &lt;StrictMode&gt;\n        &lt;div dir=\&quot;rtl\&quot;&gt;\n          &lt;App /&gt;\n        &lt;/div&gt;\n      &lt;/StrictMode&gt;\n    );&quot;],&quot;hidden&quot;:[0,true]}]}]}],&quot;externalResources&quot;:[1,&quot;[[0,\&quot;https://cdn.tailwindcss.com\&quot;]]&quot;],&quot;slot&quot;:[0,&quot;playground&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;SidePlayground&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island>
        </aside>
      </div>
    </div>
  </body></html>